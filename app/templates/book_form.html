{% extends "base.html" %}
{% block content %}
<div class="card" style="max-width:820px; margin:0 auto;">
  {% if action == 'add' %}
    <h2>Добавить книгу</h2>
    <form method="post" enctype="multipart/form-data">
  {% else %}
    <h2>Редактировать книгу</h2>
    <form method="post" enctype="multipart/form-data">
  {% endif %}

    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
      <div>
        <label>Название</label><br/>
        <input name="title" required style="width:100%; padding:8px;" value="{{ form.title if form else (book.title if book else '') }}">
      </div>
      <div>
        <label>Год</label><br/>
        <input name="year" required style="width:100%; padding:8px;" value="{{ form.year if form else (book.year if book else '') }}">
      </div>

      <div style="grid-column:1/3;">
        <label>Короткое описание</label><br/>
        <textarea name="short_description" required style="width:100%; padding:8px;" rows="4">{{ form.short_description if form else (book.short_description if book else '') }}</textarea>
      </div>

      <div>
        <label>Автор</label><br/>
        <input name="author" required style="width:100%; padding:8px;" value="{{ form.author if form else (book.author if book else '') }}">
      </div>
      <div>
        <label>Издатель</label><br/>
        <input name="publisher" required style="width:100%; padding:8px;" value="{{ form.publisher if form else (book.publisher if book else '') }}">
      </div>

      <div>
        <label>Страницы</label><br/>
        <input name="pages" required style="width:100%; padding:8px;" value="{{ form.pages if form else (book.pages if book else '') }}">
      </div>

      <div>
        <label>Жанры (Ctrl/Shift для множественного выбора)</label><br/>
        <select name="genres" multiple style="width:100%; padding:8px; min-height:110px;">
          {% for g in genres %}
            {% set gid = g['id']|string %}
            <option value="{{ g['id'] }}" {% if (current_genres is defined and gid in current_genres) or (form and (g['id']|string) in (form.getlist('genres') if form.getlist else []) ) %}selected{% endif %}>{{ g['name'] }}</option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label>Обложка (jpg/png)</label><br/>
        <input type="file" name="cover" accept="image/*">
        {% if action=='edit' and book.cover %}
          <div style="margin-top:8px;">
            Текущая обложка:<br/>
            <img src="{{ url_for('static', filename=book.cover) }}" alt="cover" style="max-width:140px; border-radius:6px; margin-top:6px;">
          </div>
        {% endif %}
      </div>
    </div>

    <div style="margin-top:12px; display:flex; gap:8px;">
      <button class="btn" type="submit">{% if action=='add' %}Добавить{% else %}Сохранить{% endif %}</button>
      <a class="btn-ghost" href="{{ url_for('books.index') }}">Отмена</a>
    </div>
  </form>
</div>
{% endblock %}
